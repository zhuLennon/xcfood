<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>美食展示</title>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
	</head>
	<body>
		<div class="clearfix nav">
			<a class="logo" href="javascript:;"></a>
			<ul class="clearfix nav-wrap">
				<li><a class="nav-item" href="index.html">首页</a></li>
				<li><a class="nav-item nav-active" href="meishi.html">美食展示</a></li>
				<li><a class="nav-item" href="sort.html">美食排行</a></li>
				<li><a class="nav-item" href="aboutus.html">关于我们</a></li>
			</ul>
		</div>
		<hr color="#533336" size="10"></hr>

		<div class="clearfix table-wrap" id="tab-span">
			<div class="search clearfix">
				<input class="inp-txt" type="text" name="address" value="输入关键字" 
				onfocus="if(this.value=='输入关键字'){this.value=''};this.style.color='black';"
				onblur="if(this.value==''||this.value=='输入关键字'){this.value='输入关键字';this.style.color='gray';}" />
				<input class="inp-btn" type="button" name="" id="search-button" value="搜索" />
			</div>
		</div>
		<div id="table-div">
			<div class="table-pic table-show clearfix" id="food">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic1.jpg" alt="" />
					</span>
					<h2 class="ms-tit">海鲜芝士大虾</h2>
					<p class="ms-txt">价格：49元</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic2.jpg" alt="" />
					</span>
					<h2 class="ms-tit">草莓布丁杯</h2>
					<p class="ms-txt">价格：12元</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap">
					<span class="ms-pic">
						<img src="img/ms-pic3.jpg" alt="" />
					</span>
					<h2 class="ms-tit">菲力黑椒牛排</h2>
					<p class="ms-txt">价格：69元</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic4.jpg" alt="" />
					</span>
					<h2 class="ms-tit">香煎排意面</h2>
					<p class="ms-txt">价格：69元</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic5.jpg" alt="" />
					</span>
					<h2 class="ms-tit">鲜香培根比萨</h2>
					<p class="ms-txt">价格：59元/24寸</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap">
					<span class="ms-pic">
						<img src="img/ms-pic6.jpg" alt="" />
					</span>
					<h2 class="ms-tit">番茄烩意面</h2>
					<p class="ms-txt">价格：39元</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap">
					<span class="ms-pic">
						<img src="img/ms-pic3.jpg" alt="" />
					</span>
					<h2 class="ms-tit">菲力黑椒牛排</h2>
					<p class="ms-txt">价格：69元</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic4.jpg" alt="" />
					</span>
					<h2 class="ms-tit">香煎排意面</h2>
					<p class="ms-txt">价格：69元</p>
				</a>
				<a href="meishi-con.html" class="ms-wrap">
					<span class="ms-pic">
						<img src="img/ms-pic6.jpg" alt="" />
					</span>
					<h2 class="ms-tit">番茄烩意面</h2>
					<p class="ms-txt">价格：39元</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic5.jpg" alt="" />
					</span>
					<h2 class="ms-tit">鲜香培根比萨</h2>
					<p class="ms-txt">价格：59元/24寸</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic2.jpg" alt="" />
					</span>
					<h2 class="ms-tit">草莓布丁杯</h2>
					<p class="ms-txt">价格：12元</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic2.jpg" alt="" />
					</span>
					<h2 class="ms-tit">草莓布丁杯</h2>
					<p class="ms-txt">价格：12元</p>
				</a>
			</div>
			<div class="table-pic clearfix">
				<a href="meishi-con.html" class="ms-wrap ms-right">
					<span class="ms-pic">
						<img src="img/ms-pic1.jpg" alt="" />
					</span>
					<h2 class="ms-tit">海鲜芝士大虾</h2>
					<p class="ms-txt">价格：49元</p>
				</a>
			</div>
			<ul class="ms-paging clearfix" id="pages">
				<li><a href="javascript:;" class="pag-item">&lt;</a></li>
				<li><a href="javascript:;" class="pag-item pag-active">1</a></li>
				<li><a href="javascript:;" class="pag-item">2</a></li>
				<li><a href="javascript:;" class="pag-item">3</a></li>
				<li><a href="javascript:;" class="pag-item">4</a></li>
				<li><a href="javascript:;" class="pag-item">&gt;</a></li>
			</ul>
		</div>

		<div class="foot">
			<div class="foot-wrap">
				<p class="foot-tit">橱窗推荐</p>
				<ul class="foot-link clearfix">
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link6.png"/></a>
					</li>
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link5.png"/></a>
					</li>
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link4.png"/></a>
					</li>
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link3.png"/></a>
					</li>
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link2.png"/></a>
					</li>
					<li class="foot-pic">
						<a href="javascript:;"><img src="img/link1.png"/></a>
					</li>
				</ul>
				<div class="copyright">
					<p>CopyRight©2015-2017 www.xc.cn All rigt rederved</p>
					<p>版权所有：信息工程学院朱新光</p>
					<p>ICP备案号：京ICP备16047255号-3本站信息由会员自主添加，如信息涉及隐私等，网站不承担任何责任！</p>
				</div>
			</div>
		</div>
		
	</body>
	<!--jq调用-->
	<script src="js/jquery-1.11.0.js" type="text/javascript"></script>

	<script type="text/javascript">
		//导航当前项切换	
		$(".nav-item").click(function(){
			$(this).parent("li").siblings().children().removeClass("nav-active");		
			//点击对象的父级（li）的兄弟级（li）的子集（a）移除类
			$(this).addClass("nav-active");												
			//给点击对象添加类
		});
		//美食系列当前项切换
		$(".table-item").click(function(){
			$(this).siblings().removeClass("table-active");
			$(this).addClass("table-active");
		});
	    //美食系列table切换
	    var oSpan = document.getElementById("tab-span");
			var spans = oSpan.querySelectorAll("span");
			var oDiv  = document.getElementById("table-div");
			var divs = oDiv.querySelectorAll("div");
			var last=spans[0];
			for(var i=0;i<spans.length;i++){
					spans[i].index=i;  //给每一个按钮添加一个自定义属性，存储的是他们对应的索引值；
					spans[i].onclick=function(){
						divs[last.index].style.display="none"; //上一个对应的div，让他隐藏
						divs[this.index].style.display="block"; //当前点击按钮对应的div显示			
						last=this; 	//把上一次点击的对象更新成当前点击的对象
					};
				};

		//获取搜索的值
        $("#search-button").click(function () {
            //获取查询的条件
            var fname = $(".inp-txt").val();

            //跳转路径
            if (fname!='输入关键字'){
                location.href="http://localhost/xcfood/meishi.html?fname="+fname;
            }
        });
	</script>

	<script type="text/javascript">
        $(function () {
            //获取fname的值
            //locaton代表当前浏览的url，search属性可以拿到？以后的参数
            var search = location.search;
            //若search为''说明后面没有参数
            if (search != '') {
                //获取第一个=后的值
                var fname = search.split("=")[1];  //搜索的内容

                //解码方式
                if (fname) {
                    //url解码
                    fname = window.decodeURIComponent(fname);
                }
                load(null,fname);
			}else {
                load(null,null);
			}
        });

        function load(currentPage,fname) {
            //发送ajax请求，请求food/pageQuery
            $.post("/xcfood/foodServlet", {currentPage: currentPage,fname:fname}, function (pb) {
                //服务器回来数据后：解析pagebean数据（pb），展示到页面上

                //写入真实页码
                var pli = "";
                //计算上一页页码数
                var beforeNum = pb.currentPage-1;
                if (beforeNum <= 0) {
                    beforeNum=1;
                }
                var beforePage = '<li><a href="javascript:load('+beforeNum+','+fname+');" class="pag-item">&lt;</a></li>';

                pli+=beforePage;

                //展示分页页码
				//前1后2模式
                // 定义开始位置begin,结束位置 end
                var begin;  //开始位置
                var end;    //结束位置

                //显示4个页面
                if (pb.totalPage<4){
                    //当总页码数不够4页
                    begin=1;
                    end=pb.totalPage;
                }else{
                    //总页码数超过4页
                    begin=pb.currentPage-1;
                    end=pb.currentPage+2;

                    //如果前边不够1个，后边补齐3个
                    if (begin < 1) {
                        begin=1;
                        end=begin+3;
                    }

                    //如果后边不足2个，前边补齐3个
                    if (end > pb.totalPage) {
                        end=pb.totalPage;
                        begin=end-3;
                    }
                }
                //循环显示页数
                for (var i = begin; i <= end; i++) {
                    var page;
                    //判断传进来的currentPage是否是当前i的页面
                    if (pb.currentPage==i){
                        //如果是，将页码数写入，并带有样式
                        var page = '<li><a href="javascript:load('+i+','+fname+');" class="pag-item pag-active">' + i + '</a></li>';
                    } else{
                        //如果不是，将页码数写入，不带有样式
                        var page = '<li><a href="javascript:load('+i+','+fname+');" class="pag-item">' + i + '</a></li>';
                    }

                    //拼接字符串
                    pli += page;
                }

                //把下一页和末页写入字符串
                //计算下一页码数
                var nextNum = pb.currentPage+1;
                if (nextNum > pb.totalPage) {
                    nextNum=pb.totalPage;
                }
                var nextPage = '<li><a href="javascript:load('+nextNum+','+fname+');" class="pag-item">&gt;</a></li>';

                pli+=nextPage;

                //将页码内容设置到ul里
                $("#pages").html(pli);


                //列表数据真实展示
                var rli = "";

                for (var i = 1; i <= pb.list.length; i++) {
                    //获取{fid:1,fname:"xxx"}
                    var food = pb.list[i-1];
                    var li ='';
					if (i % 3 == 0) {
                        li = '<a href="meishi-con.html?fid='+food.fid+'" class="ms-wrap">\n' +
                            '<span class="ms-pic">\n' +
                            '<img src="'+food.fimage+'" alt="" />\n' +
                            '</span>\n' +
                            '<h2 class="ms-tit">'+food.fname+'</h2>\n' +
                            '<p class="ms-txt">价格：'+food.price+'元</p>\n' +
                            '</a>';
					}else{
                        li = '<a href="meishi-con.html?fid='+food.fid+'" class="ms-wrap ms-right">\n' +
                            '<span class="ms-pic">\n' +
                            '<img src="'+food.fimage+'" alt="" />\n' +
                            '</span>\n' +
                            '<h2 class="ms-tit">'+food.fname+'</h2>\n' +
                            '<p class="ms-txt">价格：'+food.price+'元</p>\n' +
                            '</a>';
					}


                    rli += li;
                }
                $("#food").html(rli);


                //定位到顶部
                window.scrollTo(100,100);

            });
        }
	</script>
</html>
